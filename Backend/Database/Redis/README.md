Redis 存储系统
==========

## 什么是 Redis？

Remote Dictionary Server (Redis) 是一个开源的使用 ANSI C 语言编写、支持网络、可基于内存亦可持久化的日志型、Key- Value 数据库，并提供多种语言的 API。它通常被称为数据结构服务器，因为值（value）可以是 字符串 (String), 哈希 (Map), 链表 (List), 集合 (Set) 和 有序集合 (Sorted Set) 等类型。

## Redis 的特点什么是？

1.  支持多种数据结构，如 String (字符串)、 List (链表)、Hash (哈希表)、Set (集合)、Sorted Set (有序集合)、HyperLogLog (基数估算)。
2.  支持持久化操作，可以进行 AOF 及 RDB 数据持久化到磁盘，从而进行数据备份或数据恢复等操作，较好的防止数据丢失的手段。
3.  支持通过 Replication 进行数据复制，通过 master-slave 机制，可以实时进行数据的同步复制，支持多级复制和增量复制，master-slave 机制是 Redis 进行 HA 的重要手段。
4.  单进程请求，所有命令串行执行，并发情况下不需要考虑数据一致性问题。

## Redis 数据类型有哪些？

1.  String (字符串)
2.  Hash (哈希表)
3.  List (链表)
4.  Set (集合)
5.  Sorted Set (有序集合 zset)

## Redis 的配置以及持久化方案有几种？

### 配置：

> Redis的配置通过配置文件（redis.conf）进行，也可以通过启动时的命令行参数进行设置。一些常见的配置选项包括：

1. 绑定地址（bind）： 指定Redis监听的IP地址，可以设置为0.0.0.0以监听所有地址，或者特定的IP。

2. 端口号（port）： Redis监听的端口号，默认是6379。

3. 密码（requirepass）： 设置连接Redis需要的密码，以增加访问安全性。

4. 最大客户端连接数（maxclients）： 限制同时连接到Redis的客户端数量。

5. 是否守护进程（daemonize）： 设置Redis是否以守护进程的方式运行。

6. 数据目录（dir）： 指定持久化文件和数据库文件的存放目录。

7. 日志文件（logfile）： 指定Redis日志输出文件的路径。

8. 最大内存使用（maxmemory）： 设置Redis允许使用的最大内存量。

9. 过期时间检查频率（hz）： 每秒运行的内部时钟频率，影响到过期键的清理。

### 持久化方案：

> Redis支持多种持久化方案，以保证数据在重启或崩溃后的可靠性：

1. RDB快照（Snapshotting）： RDB持久化通过将数据库在指定时间间隔内的数据生成快照并存储在磁盘上，通常以.rdb文件的形式保存。RDB适合备份数据，但在崩溃发生时可能会丢失最后一次快照之后的数据。

2. AOF日志文件（Append-Only File）： AOF持久化记录了每次修改数据库的写操作，以追加的方式记录在一个文件中。可以通过重放AOF文件来恢复数据。AOF相对于RDB提供更好的数据安全性，但可能会对性能产生一些影响。

3. 混合持久化： Redis还可以同时使用RDB和AOF持久化，以兼顾数据备份和安全性。

4. 无持久化： 如果只需要将Redis用作缓存，并且对数据持久性要求不高，可以将持久化关闭。

> 可以通过配置文件中的选项来设置持久化方案，例如：

- save： 可以设置多个时间间隔，表示在这些间隔内，有多少个键被修改，则执行一次RDB快照。
- appendonly： 将其设置为yes启用AOF持久化。
- appendfsync： 设置AOF何时进行数据同步操作，可以是always、everysec或no。

## Redis 中的常用命令哪些？

1.  hset 存储一个哈希键值对的集合
2.  hget 获取一个哈希键的值
3.  hdel 删除一个或多个字段
4.  hgetall 获取一个哈希是键值对的集合
5.  lpush key value 向链表左侧添加
6.  rpush key value 向链表右侧添加
7.  lpop key 从左边移出一个元素
8.  rpop key 从右边移出一个元素
9.  keys \* 返回所有的 key 可以加 \* 通配
10.  exists key 判断 string 类型一个 key 是否存在 如果存在返回 1 否则返回 0

## Redis 主要消耗什么物理资源？

1. 内存（RAM）： Redis的主要特点是将数据存储在内存中，因此它主要消耗系统的内存资源。你在 Redis 中存储的数据、缓存以及执行的操作都会占用系统的内存空间。由于数据存储在内存中，Redis 能够提供非常高速的读写访问速度。

2. CPU： Redis 是一个单线程的应用，即一次只能处理一个请求。虽然它是单线程的，但它会高频率地执行计算密集型操作，例如处理读写请求、执行复杂的数据结构操作（如排序、计算等）等，这会消耗 CPU 资源。

3. 磁盘： 尽管 Redis 的主要数据存储在内存中，但它也支持持久化数据到磁盘，以便在重启后恢复数据。这涉及到将数据写入到磁盘上的持久化文件（如 RDB 文件和 AOF 日志文件）。因此，持久化操作可能会对磁盘资源产生一定的影响。

4. 网络带宽： Redis 支持网络连接，允许客户端通过网络与 Redis 服务器通信。读取和写入数据会涉及网络传输，因此网络带宽在并发访问时可能成为瓶颈。

5. 文件系统： 用于存储 Redis 的配置文件、持久化文件（如 RDB 文件和 AOF 日志文件）、日志文件以及其他与 Redis 相关的文件。

6. 操作系统资源： Redis 运行在操作系统之上，因此也会共享操作系统资源，例如进程管理、文件系统操作、内存管理等

## Redis 有哪几种数据淘汰策略？

1.  noeviction: 返回错误当内存限制达到，并且客户端尝试执行会让更多内存被使用的命令。
2.  allkeys-lru: 尝试回收最少使用的键（LRU），使得新添加的数据有空间存放。
3.  volatile-lru: 尝试回收最少使用的键（LRU），但仅限于在过期集合的键，使得新添加的数据有空间存放。
4.  allkeys-random: 回收随机的键使得新添加的数据有空间存放。
5.  volatile-random: 回收随机的键使得新添加的数据有空间存放，但仅限于在过期集合的键。
6.  volatile-ttl: 回收在过期集合的键，并且优先回收存活时间（TTL）较短的键，使得新添加的数据有空间存放。
    
## Redis 官方为什么不提供 Windows 版本？

~~因为目前 Linux 版本已经相当稳定，而且用户量很大，无需开发 windows 版本，反而会带来兼容性等问题。~~

Redis 官方没有提供官方的 Windows 版本，主要是因为 Redis 在设计和开发时主要针对类Unix系统进行了优化，而 Windows 系统与这些系统在一些方面存在显著的差异，导致在 Windows 上运行 Redis 需要进行一些额外的工作和适配。

以下是一些原因解释为什么 Redis 官方没有提供官方的 Windows 版本：

1. 性能差异： Redis 是设计用于高性能、低延迟的应用，而 Windows 和类Unix系统在底层架构上存在差异，导致在 Windows 上的性能可能不如在类Unix系统上表现出色。这可能影响 Redis 在 Windows 上的整体表现。

2. 文件系统和文件事件： Redis 使用文件事件来处理网络连接和I/O操作，这在类Unix系统上使用了特定的文件事件库（如 epoll 或 kqueue）。Windows 拥有不同的文件事件机制，需要对 Redis 进行相应的修改来适配这些差异。

3. 内存映射文件： Redis 在某些情况下使用内存映射文件来提高性能，而 Windows 上的内存映射文件机制与类Unix系统上的有所不同，需要进行适配。

4. 测试和维护成本： 在 Windows 平台上进行充分的测试、维护和支持可能需要额外的工作，包括处理平台特定的问题和Bug，这会增加开发和维护的成本。

> 虽然 Redis 官方没有提供官方的 Windows 版本，但是有一些第三方社区提供了对 Windows 的适配版本，允许在 Windows 上运行 Redis。这些版本通常对 Redis 进行了修改以适应 Windows 平台的特点。但是需要注意的是，使用这些第三方版本可能会有一些限制，性能可能不如在类Unix系统上，而且在一些特殊情况下可能会遇到问题。


## 为什么 Redis 需要把所有数据放到内存中？

Redis 为了达到最快的读写速度将数据都读到内存中，并通过异步的方式将数据写入磁盘。所以 Redis 具有快速和数据持久化的特征，如果不将数据放在内存中，磁盘 I/O 速度为严重影响 Redis 的性能。在内存越来越便宜的今天，Redis 将会越来越受欢迎， 如果设置了最大使用的内存，则数据已有记录数达到内存限值后不能继续插入新值。

## Redis 有哪些适合的场景？

1.  会话缓存（Session Cache）：最常用的一种使用 Redis 的情景是会话缓存（Session Cache），用 Redis 缓存会话比其他存储（如 Memcached）的优势在于：Redis 提供持久化。当维护一个不是严格要求一致性的缓存时，如果用户的购物车信息全部丢失，大部分人都会不高兴的，现在，他们还会这样吗？幸运的是，随着 Redis 这些年的改进，很容易找到怎么恰当的使用 Redis 来缓存会话的文档。甚至广为人知的商业平台 Magento 也提供 Redis 的插件。
2.  全页缓存（FPC）：除基本的会话 token 之外，Redis 还提供很简便的 FPC 平台。回到一致性问题，即使重启了 Redis 实例，因为有磁盘的持久化，用户也不会看到页面加载速度的下降，这是一个极大改进，类似 PHP 本地 FPC。再次以 Magento 为例，Magento 提供一个插件来使用 Redis 作为全页缓存后端。此外，对 WordPress 的用户来说，Pantheon 有一个非常好的插件 wp-redis，这个插件能帮助你以最快速度加载你曾浏览过的页面。
3.  队列：Reids 在内存存储引擎领域的一大优点是提供 list 和 set 操作，这使得 Redis 能作为一个很好的消息队列平台来使用。Redis 作为队列使用的操作，就类似于本地程序语言（如 Python）对 list 的 push/pop 操作。如果你快速的在 Google 中搜索 “Redis queues”，你马上就能找到大量的开源项目，这些项目的目的就是利用 Redis 创建非常好的后端工具，以满足各种队列需求。例如，Celery 有一个后台就是使用 Redis 作为 broker，你可以从这里去查看。
4.  排行榜 / 计数器：Redis 在内存中对数字进行递增或递减的操作实现的非常好。集合（Set）和有序集合（SortedSet）也使得我们在执行这些操作的时候变的非常简单，Redis 只是正好提供了这两种数据结构。
5.  发布 / 订阅：最后（但肯定不是最不重要的）是 Redis 的发布 / 订阅功能。发布 / 订阅的使用场景确实非常多。我已看见人们在社交网络连接中使用，还可作为基于发布 / 订阅的脚本触发器，甚至用Redis 的发布/订阅功能来建立聊天系统！