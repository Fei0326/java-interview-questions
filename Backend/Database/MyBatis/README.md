MyBatis 框架
==========

## 什么是 MyBatis？

MyBatis 是一个可以自定义 SQL、存储过程和高级映射的持久层框架。

## MyBatis 动态 SQL 是做什么的？都有哪些动态 SQL？能简述一下动态 SQL 的执行原理不？

MyBatis 动态 SQL 是为了解决在 SQL 语句中出现条件判断、分页、动态排序等情况，使得 SQL 语句能够更加灵活地生成。MyBatis 的动态 SQL 包括以下几种：

1.  `if` 元素：根据条件判断动态生成 SQL 语句；
2.  `choose（when、otherwise）`元素：类似于 Java 中的 switch 语句，根据条件选择生成 SQL 语句；
3.  `where` 元素：用于构建动态查询条件，自动去除查询语句中不必要的 where 或 and 关键字；
4.  `set` 元素：用于构建动态更新条件；
5.  `foreach` 元素：用于遍历一个集合，动态生成 SQL 语句。

动态 SQL 的执行原理是：MyBatis 在解析 Mapper.xml 文件时，会将动态 SQL 语句解析成一个完整的 SQL 语句，然后再将这个完整的 SQL 语句传递给 JDBC 执行。在解析 Mapper.xml 文件时，MyBatis 使用 OGNL 表达式来进行条件判断和数据遍历等操作，然后根据条件生成相应的 SQL 语句，最终生成一条完整的 SQL 语句，传递给 JDBC 执行。

## #{} 和 ${} 的区别是什么？

1.  `#{}` 是预编译处理，`${}` 是字符串替换。
2.  MyBatis 在处理 `#{}` 时，会将 SQL 中的 `#{}` 替换为？号，调用 PreparedStatement 的 set 方法来赋值。
3.  MyBatis 在处理 `${}` 时，就是把 `${}` 替换成变量的值。
4.  使用 `#{}` 可以有效的防止 SQL 注入，提高系统安全性。

## 为什么说 MyBatis 是半自动 ORM 映射工具？它与全自动的区别在哪里？

Hibernate 属于全自动 ORM (Object-Relational Mapping) 映射工具，使用 Hibernate 查询关联对象或者关联集合对象时，可以根据对象关系模型直接获取，所以它是全自动的。而 MyBatis 在查询关联对象或关联集合对象时，需要手动编写 SQL 来完成，所以，称之为半自动 ORM 映射工具。

## MyBatis 与 Hibernate 有哪些不同

1.  MyBatis 和 Hibernate 不同，它不完全是一个 ORM 框架，因为 MyBatis 需要程序员自己编写 SQL 语句，不过 MyBatis 可以通过 XML 或注解方式灵活配置要运行的 SQL 语句，并将 Java 对象和 SQL 语句映射生成最终执行的 SQL，最后将 SQL 执行的结果再映射生成 Java 对象。
2.  MyBatis 学习门槛低，简单易学，程序员直接编写原生态 SQL，可严格控制 SQL 执行性能，灵活度高，非常适合对关系数据模型要求不高的软件开发，例如互联网软件、企业运营类软件等，因为这类软件需求变化频繁，一但需求变化要求成果输出迅速。但是灵活的前提是 MyBatis 无法做到数据库无关性，如果需要实现支持多种数据库的软件则需要自定义多套 SQL 映射文件，工作量大。
3.  Hibernate 对象 / 关系映射能力强，数据库无关性好，对于关系模型要求高的软件（例如需求固定的定制化软件）如果用 Hibernate 开发可以节省很多代码，提高效率。但是 Hibernate 的缺点是学习门槛高，要精通门槛更高，而且怎么设计 O/R 映射，在性能和对象模型之间如何权衡，以及怎样用好 Hibernate 需要具有很强的经验和能力才行。总之，按照用户的需求在有限的资源环境下只要能做出维护性、扩展性良好的软件架构都是好架构，所以框架只有适合才是最好。

## MyBatis 的好处是什么

1.  MyBatis 把 SQL 语句从 Java 源程序中独立出来，放在单独的 XML 文件中编写，给程序的维护带来了很大便利。
2.  MyBatis 封装了底层 JDBC API 的调用细节，并能自动将结果集转换成 Java Bean 对象， 大大简化了 Java 数据库编程的重复工作。
3.  因为 MyBatis 需要程序员自己去编写 SQL 语句，程序员可以结合数据库自身的特点灵活控制 SQL 语句，因此能够实现比 Hibernate 等全自动 ORM 框架更高的查询效率，能够完成复杂查询。

## 什么是 MyBatis 的接口绑定，有什么好处？

接口映射就是在 MyBatis 中任意定义接口，然后把接口里面的方法和 SQL 语句绑定，我们直接调用接口方法就可以，这样比起原来了 SqlSession 提供的方法我们可以有更加灵活的选择和设置。

## 接口绑定有几种实现方式，分别是怎么实现的？

接口绑定有两种实现方式：

1.  通过注解绑定，就是在接口的方法上面加上 @Select@Update 等注解里面包含 SQL 语句来绑定。
2.  通过 XML 里面写 SQL 来绑定，在这种情况下，要指定 XML 映射文件里面的 namespace 必须为接口的全路径名。

## 当实体类中的属性名和表中的字段名不一样，如果将查询的结果封装到指定 POJO？

1.  通过在查询的 SQL 语句中定义字段名的别名。
2.  通过来映射字段名和实体类属性名的一一对应的关系。

## Mapper DAO 层开发规范

1.  接口的全路径要和映射文件的 namespace 保持一致。
2.  接口的方法名要和映射文件中的 statementId 保持一致。
3.  接口方法的参数类型，返回类型要和映射文件中的 parameterType,resultType 保持一致。
4.  接口和映射文件的名字最好保持一致 例如：UserMapper.java/UserMapper.xml。
5.  接口和映射文件最好放到同一个目录。